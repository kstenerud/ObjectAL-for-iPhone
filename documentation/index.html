<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ObjectAL: ObjectAL for iPhone</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ObjectAL
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">ObjectAL for iPhone </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p><b>iOS Audio development, minus the headache.</b> <br/>
<br/>
</p>
<p>Version 2.1 <br/>
 <br/>
</p>
<p>Copyright 2009-2011 Karl Stenerud <br/>
<br/>
</p>
<p>Released under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License v2.0</a></p>
<p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="contents_sec"></a>
Contents</h2>
<ul>
<li><a class="el" href="index.html#intro_sec">Introduction</a></li>
<li><a class="el" href="index.html#objectal_and_openal_sec">ObjectAL and OpenAL</a></li>
<li><a class="el" href="index.html#add_objectal_sec">Adding ObjectAL to your project</a> (also, installing the documentation into XCode)</li>
<li><a class="el" href="index.html#configuration_sec">Compile-Time Configuration</a></li>
<li><a class="el" href="index.html#audio_formats_sec">Audio Formats</a></li>
<li><a class="el" href="index.html#choosing_sec">Choosing Playback Types</a></li>
<li><a class="el" href="index.html#use_iossimpleaudio_sec">Using OALSimpleAudio</a></li>
<li><a class="el" href="index.html#use_objectal_sec">Using the OpenAL Objects and OALAudioTrack</a></li>
<li><a class="el" href="index.html#other_examples_sec">Other Examples</a></li>
<li><a class="el" href="index.html#ios_issues_sec">iOS Issues that can impede playback</a></li>
<li><a class="el" href="index.html#simulator_issues_sec">Simulator Issues</a></li>
</ul>
<p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="intro_sec"></a>
Introduction</h2>
<p><b>ObjectAL for iPhone</b> is designed to be a simpler, more intuitive interface to OpenAL and AVAudioPlayer. There are four main parts to <b>ObjectAL for iPhone</b>:<br/>
<br/>
</p>
<div class="image">
<img src="ObjectAL-Overview1.png" alt="ObjectAL-Overview1.png"/>
</div>
 <ul>
<li><a href="index.html#objectal_and_openal_sec" class="el">ObjectAL</a> gives you full access to the OpenAL system without the hassle of the C API. All OpenAL operations can be performed using first class objects and properties, without needing to muddle around with arrays of data, maintain IDs, or pass around pointers to basic types. ObjectALManager also provides sound loading routines.</li>
</ul>
<ul>
<li><a class="el" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a> provides a simpler interface to AVAudioPlayer, allowing you to play, stop, pause, fade, and mute background music tracks.</li>
</ul>
<ul>
<li><a class="el" href="interface_o_a_l_audio_session.html" title="Handles the audio session and interrupts.">OALAudioSession</a> handles audio session management in iOS devices, and provides an easy way to configure session behavior such as how to handle iPod-style music and the silent switch.</li>
</ul>
<ul>
<li><a class="el" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> layers on top of the other three, providing an even simpler interface for playing background music and sound effects.</li>
</ul>
<p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="objectal_and_openal_sec"></a>
ObjectAL and OpenAL</h2>
<p><b>ObjectAL</b> follows the same basic principles as the <a href="http://connect.creativelabs.com/openal">OpenAL API by Creative Labs</a>.</p>
<div class="image">
<img src="ObjectAL-Overview2.png" alt="ObjectAL-Overview2.png"/>
</div>
 <ul>
<li><a class="el" href="interface_open_a_l_manager.html" title="Manager class for OpenAL objects (ObjectAL).">OpenALManager</a> provides some overall controls that affect everything, manages the current context, and provides audio loading routines.</li>
</ul>
<ul>
<li><a class="el" href="interface_a_l_device.html" title="A device is a logical mapping to an audio device through the OpenAL implementation.">ALDevice</a> represents a physical audio device. <br/>
 Each device can have one or more contexts (<a class="el" href="interface_a_l_context.html" title="A context encompasses a single listener and a series of sources.">ALContext</a>) created on it, and can have multiple buffers (<a class="el" href="interface_a_l_buffer.html" title="A buffer for audio data that will be played via a SoundSource.">ALBuffer</a>) associated with it.</li>
</ul>
<ul>
<li><a class="el" href="interface_a_l_context.html" title="A context encompasses a single listener and a series of sources.">ALContext</a> controls the overall sound environment, such as distance model, doppler effect, and speed of sound. <br/>
 Each context has one listener (<a class="el" href="interface_a_l_listener.html" title="The listener represents the user who is listening to sounds in 3D space.">ALListener</a>), and can have multiple sources (<a class="el" href="interface_a_l_source.html" title="A source represents an object that emits sound which can be heard by a listener.">ALSource</a>) opened on it (up to a maximum of 32 overall on iPhone).</li>
</ul>
<ul>
<li><a class="el" href="interface_a_l_listener.html" title="The listener represents the user who is listening to sounds in 3D space.">ALListener</a> represents the listener of sounds originating on its context (one listener per context). It has position, orientation, and velocity.</li>
</ul>
<ul>
<li><a class="el" href="interface_a_l_source.html" title="A source represents an object that emits sound which can be heard by a listener.">ALSource</a> is a sound emitting source that plays sound data from an <a class="el" href="interface_a_l_buffer.html" title="A buffer for audio data that will be played via a SoundSource.">ALBuffer</a>. It has position, direction, velocity, as well as other properties which determine how the sound is emitted.</li>
</ul>
<ul>
<li><a class="el" href="interface_a_l_channel_source.html" title="A Sound source composed of other sources.">ALChannelSource</a> allows you to reserve a certain number of sources for special purposes.</li>
</ul>
<ul>
<li><a class="el" href="interface_a_l_buffer.html" title="A buffer for audio data that will be played via a SoundSource.">ALBuffer</a> is simply a container for sound data. Only linear PCM is supported directly, but <a class="el" href="interface_open_a_l_manager.html" title="Manager class for OpenAL objects (ObjectAL).">OpenALManager</a> load methods, and <a class="el" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> effect preload and play methods, will automatically convert any formats that don't require hardware decoding (though conversion results in a longer loading time).</li>
</ul>
<p><b>Note:</b> While OpenAL allows for multiple devices and contexts, in practice you'll only use one device and one context when using OpenAL under iOS.</p>
<p>Further information regarding the more advanced features of OpenAL (such as distance models) are available via the <a href="http://connect.creativelabs.com/openal/Documentation/Forms/AllItems.aspx">OpenAL Documentation at Creative Labs</a>. <br/>
 In particular, read up on the various property values for sources and listeners (such as Doppler Shift) in the <a href="http://connect.creativelabs.com/openal/Documentation/OpenAL_Programmers_Guide.pdf">OpenAL Programmer's Guide</a>, and distance models in section 3 of the <a href="http://connect.creativelabs.com/openal/Documentation/OpenAL%201.1%20Specification.pdf">OpenAL Specification</a>.</p>
<p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="add_objectal_sec"></a>
Adding ObjectAL to your project</h2>
<p>To add ObjectAL to your project, do the following:</p>
<ol>
<li>
<p class="startli">Copy ObjectAL/ObjectAL from this project into your project. You can simply drag it into the "Groups &amp; Files" section in xcode if you like (be sure to select "Copy items into destination group's folder"). <br/>
 Alternatively, you can build ObjectAL as a static library (as it's configured to do in the ObjectAL demo project).<br/>
<br/>
 </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Add the following frameworks to your project: </p>
<ul>
<li>
OpenAL.framework </li>
<li>
AudioToolbox.framework </li>
<li>
AVFoundation.framework </li>
</ul>
<p><br/>
 </p>
<p class="endli"></p>
</li>
<li>
Start using ObjectAL!<br/>
<br/>
 </li>
</ol>
<p><br/>
 <b>Note:</b> The demos in this project use <a href="http://www.cocos2d-iphone.org">Cocos2d</a>, a very nice 2d game engine. However, ObjectAL doesn't require it. You can just as easily use ObjectAL in your Cocoa app or anything you wish. <br/>
 <br/>
 <b>Note #2:</b> You do NOT have to provide a link to the Apache license from within your application. Simply including a copy of the license in your project is sufficient.</p>
<p><br/>
 </p>
<h3><a class="anchor" id="install_dox"></a>
Installing the ObjectAL Documentation into XCode</h3>
<p>By installing the ObjectAL documentation into XCode's Developer Documentation system, you gain the ability to look up ObjectAL classes and methods just like you'd look up Apple classes and methods. You can install the ObjectAL documentation into XCode's Developer Documentation system by doing the following:</p>
<ol type="1">
<li>Install <a href="http://www.doxygen.org">Doxygen</a>. You can either use the OSX installer or MacPorts.</li>
<li>Build the "Documentation" target in this project.</li>
<li>Open the developer documentation and type "ObjectAL" into the search box.</li>
</ol>
<p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="configuration_sec"></a>
Compile-Time Configuration</h2>
<p><b><a class="el" href="_object_a_l_config_8h_source.html">ObjectALConfig.h</a></b> contains configuration defines that will affect at a high level how ObjectAL behaves. Look inside <b><a class="el" href="_object_a_l_config_8h_source.html">ObjectALConfig.h</a></b> to see what can be configured, and what each configuration value does. <br/>
 The recommended values are fine for most users, but Cocos2D users may want to set OBJECTAL_CFG_USE_COCOS2D_ACTIONS so that the audio actions (such as fade) use the Cocos2D action manager.</p>
<p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="audio_formats_sec"></a>
Audio Formats</h2>
<p>The audio formats officially supported by Apple are <a href="http://developer.apple.com/library/ios/#documentation/AudioVideo/Conceptual/MultimediaPG/UsingAudio/UsingAudio.html">defined here</a>. <br/>
<br/>
</p>
<h3><a class="anchor" id="audio_formats_avaudioplayer"></a>
OALAudioTrack Supported Formats</h3>
<p><a class="el" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a> supports all hardware and software decoded formats. <br/>
<br/>
</p>
<h3><a class="anchor" id="audio_formats_openal"></a>
OpenAL Supported Formats</h3>
<p>OpenAL officially supports 8 or 16 bit PCM data only. However, Apple's implementation only seems to work with 16 bit data. <br/>
</p>
<p>The effects preloading/playing methods in <a class="el" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> and the buffer loading methods in <a class="el" href="interface_open_a_l_manager.html" title="Manager class for OpenAL objects (ObjectAL).">OpenALManager</a> can load any audio file that can be software decoded. However, there is a cost incurred at load time converting to a native OpenAL format. To avoid this, convert all of your samples to a CAFF container with 16-bit little endian integer PCM format and the same sample rate as "mixerOutputFrequency" in <a class="el" href="interface_open_a_l_manager.html" title="Manager class for OpenAL objects (ObjectAL).">OpenALManager</a> (by default, 44100Hz). Note, however, that uncompressed files can get quite large.<br/>
</p>
<p>Convert to iOS native uncompressed format using Apple's "afconvert" command line tool:</p>
<div class="fragment"><pre class="fragment"> afconvert -f caff -d LEI16@44100 sourcefile.wav destfile.caf 
</pre></div><p>Alternatively, if sound file load time is not an issue for you, you can lower your app footprint size (for over-the-air app download) by using a compressed format. <br/>
</p>
<p>Convert to AAC compressed format with CAFF container using Apple's "afconvert" command line tool:</p>
<div class="fragment"><pre class="fragment"> afconvert -f caff -d aac sourcefile.wav destfile.caf 
</pre></div><p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="choosing_sec"></a>
Choosing Playback Types</h2>
<p><b>OpenAL</b> (<a class="el" href="interface_a_l_source.html" title="A source represents an object that emits sound which can be heard by a listener.">ALSource</a>, or effects in <a class="el" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a>) and <b>AVAudioPlayer</b> (<a class="el" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a>, or background audio in <a class="el" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a>) are playback technologies built for different purposes. OpenAL is designed for game-style short sound effects that have no playback delay. AVAudioPlayer is designed for music playback. You can of course mix and match as you please.</p>
<table class="doxtable">
<tr>
<td></td><td><b>OpenAL</b> </td><td><b>AVAudioPlayer</b>  </td></tr>
<tr>
<td><b>Playback Delay</b> </td><td>None </td><td>Small delay if not preloaded  </td></tr>
<tr>
<td><b>Format on Disk</b> </td><td><a href="http://developer.apple.com/library/ios/#documentation/AudioVideo/Conceptual/MultimediaPG/UsingAudio/UsingAudio.html">Any software decodable format</a> </td><td><a href="http://developer.apple.com/library/ios/#documentation/AudioVideo/Conceptual/MultimediaPG/UsingAudio/UsingAudio.html">Any software decodable format, or any hardware format if using hardware</a>  </td></tr>
<tr>
<td><b>Decoding</b> </td><td>During load </td><td>During playback  </td></tr>
<tr>
<td><b>Memory Use</b> </td><td>Entire file loaded and decompressed into memory </td><td>File streamed realtime (very low memory use)  </td></tr>
<tr>
<td><b>Max Simult. Sources</b> </td><td>32 </td><td>As many as the CPU can handle  </td></tr>
<tr>
<td><b>Playback Performance</b> </td><td>Good </td><td>Excellent with 1 track (if using hardware). Good with 2 tracks. Not so good with more (each non-hardware track taxes the CPU significantly, especially if the files are compressed).  </td></tr>
<tr>
<td><b>Looped Playback</b> </td><td>Yes (on or off) </td><td>Yes (specify number of loops or -1 = forever)  </td></tr>
<tr>
<td><b>Panning</b> </td><td>Yes (mono files only) </td><td>Yes (iOS 4.0+ only)  </td></tr>
<tr>
<td><b>Positional Audio</b> </td><td>Yes (mono files only) </td><td>No  </td></tr>
<tr>
<td><b>Modify Pitch</b> </td><td>Yes </td><td>No  </td></tr>
<tr>
<td><b>Audio Power Metering</b> </td><td>No </td><td>Yes  </td></tr>
</table>
<p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="use_iossimpleaudio_sec"></a>
Using OALSimpleAudio</h2>
<p>By far, the easiest component to use is <a class="el" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a>. You sacrifice some power for ease-of-use, but for many projects it is more than sufficient. You can also use your own instances of <a class="el" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a>, <a class="el" href="interface_a_l_source.html" title="A source represents an object that emits sound which can be heard by a listener.">ALSource</a>, <a class="el" href="interface_a_l_buffer.html" title="A buffer for audio data that will be played via a SoundSource.">ALBuffer</a> and such alongside of <a class="el" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> if you want (just be sure to set OALSimpleAudio's reservedSources to less than 32 if you want to make your own instances of <a class="el" href="interface_a_l_source.html" title="A source represents an object that emits sound which can be heard by a listener.">ALSource</a>).</p>
<p>Here is a code example using purely <a class="el" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a>:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// OALSimpleAudioSample.h</span>

<span class="keyword">@interface </span>OALSimpleAudioSample : NSObject
{
    <span class="comment">// No objects to keep track of...</span>
}

<span class="keyword">@end</span>


<span class="comment">// OALSimpleAudioSample.m</span>

<span class="preprocessor">#import &quot;OALSimpleAudioSample.h&quot;</span>
<span class="preprocessor">#import &quot;ObjectAL.h&quot;</span>


<span class="preprocessor">#define SHOOT_SOUND @&quot;shoot.caf&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#define EXPLODE_SOUND @&quot;explode.caf&quot;</span>
<span class="preprocessor"></span>
<span class="preprocessor">#define INGAME_MUSIC_FILE @&quot;bg_music.mp3&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#define GAMEOVER_MUSIC_FILE @&quot;gameover_music.mp3&quot;</span>
<span class="preprocessor"></span>

<span class="keyword">@implementation </span>OALSimpleAudioSample

- (id) init
{
    <span class="keywordflow">if</span>(nil != (<span class="keyword">self</span> = [super init]))
    {
        <span class="comment">// We don&#39;t want ipod music to keep playing since</span>
        <span class="comment">// we have our own bg music.</span>
        [<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance].allowIpod = NO;
        
        <span class="comment">// Mute all audio if the silent switch is turned on.</span>
        [<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance].honorSilentSwitch = YES;
        
        <span class="comment">// This loads the sound effects into memory so that</span>
        <span class="comment">// there&#39;s no delay when we tell it to play them.</span>
        [[<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance] preloadEffect:SHOOT_SOUND];
        [[<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance] preloadEffect:EXPLODE_SOUND];
    }
    <span class="keywordflow">return</span> <span class="keyword">self</span>;
}

- (void) onGameStart
{
    <span class="comment">// Play the BG music and loop it.</span>
    [[<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance] playBg:INGAME_MUSIC_FILE loop:YES];
}

- (void) onGamePause
{
    [<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance].paused = YES;
}

- (void) onGameResume
{
    [<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance].paused = NO;
}

- (void) onGameOver
{
    <span class="comment">// Could use stopEverything here if you want</span>
    [[<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance] stopAllEffects];
    
    <span class="comment">// We only play the game over music through once.</span>
    [[<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance] playBg:GAMEOVER_MUSIC_FILE];
}

- (void) onShipShotABullet
{
    [[<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance] playEffect:SHOOT_SOUND];
}

- (void) onShipGotHit
{
    [[<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance] playEffect:EXPLODE_SOUND];
}

- (void) onQuitToMainMenu
{
    <span class="comment">// Stop all music and sound effects.</span>
    [[<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance] stopEverything];   
    
    <span class="comment">// Unload all sound effects and bg music so that it doesn&#39;t fill</span>
    <span class="comment">// memory unnecessarily.</span>
    [[<a class="code" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> sharedInstance] unloadAllEffects];
}

<span class="keyword">@end</span>
</pre></div><p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="use_objectal_sec"></a>
Using the OpenAL Objects and OALAudioTrack</h2>
<p>The OpenAL objects and <a class="el" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a> offer you much more power at the cost of complexity. Here's the same thing as above, done using OpenAL components and <a class="el" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a>:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// OpenALAudioTrackSample.h</span>

<span class="preprocessor">#import &lt;Foundation/Foundation.h&gt;</span>
<span class="preprocessor">#import &quot;ObjectAL.h&quot;</span>


<span class="keyword">@interface </span>OpenALAudioTrackSample : NSObject
{
    <span class="comment">// Sound Effects</span>
    <a class="code" href="interface_a_l_device.html" title="A device is a logical mapping to an audio device through the OpenAL implementation.">ALDevice</a>* device;
    <a class="code" href="interface_a_l_context.html" title="A context encompasses a single listener and a series of sources.">ALContext</a>* context;
    <a class="code" href="interface_a_l_channel_source.html" title="A Sound source composed of other sources.">ALChannelSource</a>* channel;
    <a class="code" href="interface_a_l_buffer.html" title="A buffer for audio data that will be played via a SoundSource.">ALBuffer</a>* shootBuffer;  
    <a class="code" href="interface_a_l_buffer.html" title="A buffer for audio data that will be played via a SoundSource.">ALBuffer</a>* explosionBuffer;
    
    <span class="comment">// Background Music</span>
    <a class="code" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a>* musicTrack;
}

<span class="keyword">@end</span>


<span class="comment">// OpenALAudioTrackSample.m</span>

<span class="preprocessor">#import &quot;OpenALAudioTrackSample.h&quot;</span>


<span class="preprocessor">#define SHOOT_SOUND @&quot;shoot.caf&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#define EXPLODE_SOUND @&quot;explode.caf&quot;</span>
<span class="preprocessor"></span>
<span class="preprocessor">#define INGAME_MUSIC_FILE @&quot;bg_music.mp3&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#define GAMEOVER_MUSIC_FILE @&quot;gameover_music.mp3&quot;</span>
<span class="preprocessor"></span>

<span class="keyword">@implementation </span>OpenALAudioTrackSample

- (id) init
{
    <span class="keywordflow">if</span>(nil != (<span class="keyword">self</span> = [super init]))
    {
        <span class="comment">// Create the device and context.</span>
        <span class="comment">// Note that it&#39;s easier to just let OALSimpleAudio handle</span>
        <span class="comment">// these rather than make and manage them yourself.</span>
        device = [[<a class="code" href="interface_a_l_device.html" title="A device is a logical mapping to an audio device through the OpenAL implementation.">ALDevice</a> <a class="code" href="interface_a_l_device.html#a6e77c8abc083a0c854ace2f7040d9c0e" title="Open the specified device.">deviceWithDeviceSpecifier</a>:nil] retain];
        context = [[<a class="code" href="interface_a_l_context.html" title="A context encompasses a single listener and a series of sources.">ALContext</a> <a class="code" href="interface_a_l_context.html#a68f550df86452de025e3a79154c5dcb3" title="Create a new context on the specified device.">contextOnDevice</a>:device <a class="code" href="interface_a_l_context.html#a68f550df86452de025e3a79154c5dcb3" title="Create a new context on the specified device.">attributes</a>:nil] retain];
        [<a class="code" href="interface_open_a_l_manager.html" title="Manager class for OpenAL objects (ObjectAL).">OpenALManager</a> sharedInstance].currentContext = context;
        
        <span class="comment">// Deal with interruptions for me!</span>
        [<a class="code" href="interface_o_a_l_audio_session.html" title="Handles the audio session and interrupts.">OALAudioSession</a> sharedInstance].handleInterruptions = YES;
        
        <span class="comment">// We don&#39;t want ipod music to keep playing since</span>
        <span class="comment">// we have our own bg music.</span>
        [<a class="code" href="interface_o_a_l_audio_session.html" title="Handles the audio session and interrupts.">OALAudioSession</a> sharedInstance].allowIpod = NO;
        
        <span class="comment">// Mute all audio if the silent switch is turned on.</span>
        [<a class="code" href="interface_o_a_l_audio_session.html" title="Handles the audio session and interrupts.">OALAudioSession</a> sharedInstance].honorSilentSwitch = YES;
        
        <span class="comment">// Take all 32 sources for this channel.</span>
        <span class="comment">// (we probably won&#39;t use that many but what the heck!)</span>
        channel = [[<a class="code" href="interface_a_l_channel_source.html" title="A Sound source composed of other sources.">ALChannelSource</a> <a class="code" href="interface_a_l_channel_source.html#a192f40533492039fedf24c4a1a57f885" title="Create a channel with a number of sources.">channelWithSources</a>:32] retain];
        
        <span class="comment">// Preload the buffers so we don&#39;t have to load and play them later.</span>
        shootBuffer = [[[<a class="code" href="interface_open_a_l_manager.html" title="Manager class for OpenAL objects (ObjectAL).">OpenALManager</a> sharedInstance]
                        bufferFromFile:SHOOT_SOUND] retain];
        explosionBuffer = [[[<a class="code" href="interface_open_a_l_manager.html" title="Manager class for OpenAL objects (ObjectAL).">OpenALManager</a> sharedInstance]
                            bufferFromFile:EXPLODE_SOUND] retain];
        
        <span class="comment">// Background music track.</span>
        musicTrack = [[<a class="code" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a> <a class="code" href="interface_o_a_l_audio_track.html#a87c4ba40b57bc875d31917ae34af1d5f" title="Create a new audio track.">track</a>] retain];
    }
    <span class="keywordflow">return</span> <span class="keyword">self</span>;
}

- (void) dealloc
{
    [musicTrack release];
    
    [channel release];
    [shootBuffer release];
    [explosionBuffer release];
    
    <span class="comment">// Note: You&#39;ll likely only have one device and context open throughout</span>
    <span class="comment">// your program, so in a real program you&#39;d be better off making a</span>
    <span class="comment">// singleton object that manages the device and context, rather than</span>
    <span class="comment">// allocating/deallocating it here.</span>
    <span class="comment">// Most of the demos just let OALSimpleAudio manage the device and context</span>
    <span class="comment">// for them.</span>
    [context release];
    [device release];
    
    [<span class="keyword">super</span> dealloc];
}

- (void) onGameStart
{
    <span class="comment">// Play the BG music and loop it forever.</span>
    [musicTrack playFile:INGAME_MUSIC_FILE loops:-1];
}

- (void) onGamePause
{
    musicTrack.<a class="code" href="interface_o_a_l_audio_track.html#ae6d53864b20348e6bbc110c5aec24463" title="If true, pause playback.">paused</a> = YES;
    channel.paused = YES;
}

- (void) onGameResume
{
    channel.paused = NO;
    musicTrack.paused = NO;
}

- (void) onGameOver
{
    [channel stop];
    [musicTrack stop];
    
    <span class="comment">// We only play the game over music through once.</span>
    [musicTrack playFile:GAMEOVER_MUSIC_FILE];
}

- (void) onShipShotABullet
{
    [channel play:shootBuffer];
}

- (void) onShipGotHit
{
    [channel play:explosionBuffer];
}

- (void) onQuitToMainMenu
{
    <span class="comment">// Stop all music and sound effects.</span>
    [channel stop];
    [musicTrack stop];
}

<span class="keyword">@end</span>
</pre></div><p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="other_examples_sec"></a>
Other Examples</h2>
<p>The demo scenes in this distribution have been crafted to demonstrate common uses of this library. Try them out and go through the code to see how it's done. I've done my best to keep the code readable. Really!</p>
<p>The current demos are:</p>
<ul>
<li><b>SingleSourceDemo</b>: Demonstrates using a location based source and a listener.</li>
<li><b>TwoSourceDemo</b>: Demonstrates using two location based sources and a listener.</li>
<li><b>VolumePitchPanDemo</b>: Demonstrates using gain, pitch, and pan controls.</li>
<li><b>CrossFadeDemo</b>: Demonstrates crossfading between two sources.</li>
<li><b>ChannelsDemo</b>: Demonstrates using audio channels.</li>
<li><b>FadeDemo</b>: Demonstrates realtime fading with <a class="el" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a> and <a class="el" href="interface_a_l_source.html" title="A source represents an object that emits sound which can be heard by a listener.">ALSource</a>.</li>
<li><b>AudioTrackDemo</b>: Demonstrates using multiple <a class="el" href="interface_o_a_l_audio_track.html" title="Plays an audio track via AVAudioPlayer.">OALAudioTrack</a> objects.</li>
<li><b>HardwareDemo</b>: Demonstrates hardware monitoring features.</li>
<li><b>AudioSessionDemo</b>: Allows you to play with various audio session settings.</li>
<li><b>PlanetKillerDemo</b>: Demonstrates using <a class="el" href="interface_o_a_l_simple_audio.html" title="A simpler interface to the ObjectAL sound library.">OALSimpleAudio</a> in a game setting.</li>
</ul>
<p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="ios_issues_sec"></a>
iOS Issues that can impede playback</h2>
<p>Certain versions of iOS have bugs or quirks, requiring workarounds. ObjectAL tries to handle most of these automatically, but there are cases that require specific handling by the developer. These are:</p>
<p><br/>
 </p>
<h3><a class="anchor" id="mpmovieplayercontroller_ios3"></a>
MPMoviePlayerController on iOS 3.x</h3>
<p>In iOS 3.x, MPMoviePlayerController doesn't play nice, and takes over the audio session when you play a video. In order to mitigate this, you must manually suspend OpenAL, play the video, and then manually unsuspend once video playback finishes:</p>
<div class="fragment"><pre class="fragment">- (void) playVideo
{   
    <span class="keywordflow">if</span>([myMoviePlayer respondsToSelector:<span class="keyword">@selector</span>(view)])
    {
        [myMoviePlayer setFullscreen:YES animated:YES];
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// No &quot;view&quot; method means we are &lt; 4.0</span>
        <span class="comment">// Manually suspend so iOS 3.x doesn&#39;t clobber our session!</span>
        [<a class="code" href="interface_open_a_l_manager.html" title="Manager class for OpenAL objects (ObjectAL).">OpenALManager</a> sharedInstance].manuallySuspended = YES;
    }

    [myMoviePlayer play];
    
    [[NSNotificationCenter defaultCenter] 
     addObserver:<span class="keyword">self</span>
     selector:<span class="keyword">@selector</span>(movieFinishedCallback:)
     name:MPMoviePlayerPlaybackDidFinishNotification
     <span class="keywordtype">object</span>:myMoviePlayer];
}

-(void)movieFinishedCallback:(NSNotification *)notification
{
    <span class="keywordflow">if</span>([myMoviePlayer respondsToSelector:<span class="keyword">@selector</span>(view)])
    {
        <span class="keywordflow">if</span> (myMoviePlayer.fullscreen)
        {
            [myMoviePlayer setFullscreen:NO animated:YES];
        }
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// No &quot;view&quot; method means we are &lt; 4.0</span>
        <span class="comment">// Manually unsuspend</span>
        [<a class="code" href="interface_open_a_l_manager.html" title="Manager class for OpenAL objects (ObjectAL).">OpenALManager</a> sharedInstance].manuallySuspended = NO;
    }
}
</pre></div><p> <br/>
 </p>
<h3><a class="anchor" id="mpmusicplayercontroller_ios4_0"></a>
MPMusicPlayerController on iOS 4.0</h3>
<p>On iOS 4.0, MPMusicPlayerController sends an interrupt when it begins playback, but doesn't send a corresponding "end interrupt" when it ends. To work around this, force an "end interrupt" after starting playback: </p>
<div class="fragment"><pre class="fragment">    [[<a class="code" href="interface_o_a_l_audio_session.html" title="Handles the audio session and interrupts.">OALAudioSession</a> sharedInstance] forceEndInterruption];
</pre></div><p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="simulator_issues_sec"></a>
Simulator Issues</h2>
<p>As you've likely heard time and time again, the simulator is no substitute for the real thing. The simulator is buggy. It can run faster or slower than a real device. It fails system calls that a real device doesn't. It shows graphics glitches that a real device doesn't. Sounds stop working, clicks and static, dogs and cats living together, etc, etc. When things look wrong, try it on a real device before bugging people.</p>
<p><br/>
 </p>
<h3><a class="anchor" id="simulator_limitations"></a>
Simulator Limitations</h3>
<p>The simulator does not support setting audio modes, so setting allowIpod or honorSilentSwitch in <a class="el" href="interface_o_a_l_audio_session.html" title="Handles the audio session and interrupts.">OALAudioSession</a> will have no effect in the simulator.</p>
<p><br/>
 </p>
<h3><a class="anchor" id="simulator_errors"></a>
Error Codes on the Simulator</h3>
<p>From time to time, the simulator can get confused, and start spitting out spurious errors. When this happens, check on a real device to make sure it's not just a simulator issue. Usually quitting and restarting the simulator will fix it, but sometimes you may have to reboot your machine as well.</p>
<p><br/>
 </p>
<h3><a class="anchor" id="simulator_playback"></a>
Playback Issues</h3>
<p>The simulator is notoriously finicky when it comes to audio playback. Any number of programs you've installed on your mac can cause the simulator to stop playing bg music, or effects, or both!</p>
<p>Some things to check when sound stops working:</p>
<ul>
<li>Try resetting and restarting the simulator.</li>
<li>Try restarting XCode, cleaning, and recompiling your project.</li>
<li>Try rebooting your computer.</li>
<li>Open "Audio MIDI Setup" (type "midi" into spotlight to find it) and make sure "Built-in Output" is set to 44100.0 Hz.</li>
<li>Go to System Preferences -&gt; Sound -&gt; Output, and ensure that "Play sound effects through" is set to "Internal Speakers"</li>
<li>Go to System Preferences -&gt; Sound -&gt; Input, and ensure that it is using internal sound devices.</li>
<li>Go to System Preferences -&gt; Sound -&gt; Sound Effects, and ensure "Play user interface sound
   effects" is checked.</li>
<li>Some codecs may cause problems with sound playback. Try removing them.</li>
<li>Programs that redirect audio can wreak havoc on the simulator. Try removing them. </li>
</ul>
</div></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Properties</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sun Mar 18 2012 11:27:49 for ObjectAL by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.5.1
</small></address>

</body>
</html>
